import 'macros' as {$}
import 'utl' as :L, :play, :toZenkaku
import 'lib.lume'
import 'ui' as :Scene, :BGM
import 'main' as :Castle, :Charactor, :MessageBoxRetro, :SelectBoxRetro, :g_player, :å®ç®±, :æ‰‰, :LevelUps, :play_wait
local *


_ = $mml2ogg([[
Tempo(128)
TR(1)
@8o5l8 redece<b>e<a2+4r4>
r'fd''ec''fd'd'fd'c'fd'<b2+4r4>
rgfgegc#g f4g4a4gf
e4ced4e-4e1
l16 [2 r8ag#a8ee-e8c<b>c8<a8> ]
l8 <bg>c<g>f<a>c<a >e<eg#b>e<g>c#e
l16 [2 r8ag#a8fef8dc#d8<a8> ]
l8 <bg>c<g>f<a>cf e<'fa''eg#''df''ce''<b>d''<a>c''<gb>'>
TR(2)v(75)
@8l4o3  arrrl8ra>ceagfe
l4drba l8g#eg#bSub{>e4<}ref#g#
a>dedc#e<a>e d<a>e<a>f<a>ed
c<g>e<gb>f<a>f#g#<eg#b>edc<b
l16 a8>c<b>c8c<b>'c<f#>'8ee-e8c8<
    g8>c<b>c8c<b>'c<f#>'8ee-e8c8<
l4 fede-e2a2
l16 d8>fec8dc#d8fef8d8<
    >c8fec8dc#d8fef8d8<
l8 fed2 e4r4+2 ]], castle, 30.0)


mapdata = $to2d[[
@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@CCCCCCCCCC@@@@@@@@
@@@@@@@@C''''''''C@@@@@@@@
@@@@@@@@C'AAAAAA'C@@@@@@@@
@@@@@@@@C'A'AA'A'C@@@@@@@@
@@@@@@@@C''''''''C@@@@@@@@
@@@@@@@@C''''''''C@@@@@@@@
@@@@@@@@C''''''''C@@@@@@@@
@@@@@@@@CCCC'CCCCC@@@@@@@@
@@@@@@@@C'''''''4C@@@@@@@@
@@@@@@@@CCCCCCCCCC@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@]]


-- buildã‚’å‘¼ã¶ã¨ã‚·ãƒ¼ãƒ³(ã‚·ãƒŠãƒªã‚ª)ã‚’ä½œã‚‹
-- ã„ãã¤ã‹ã®build_xxx()ã‚’ï¼‘ãƒ•ã‚¡ã‚¤ãƒ«ã«å…¥ã‚Œã‚‹ã€‚å…¨ä½“çš„ã«åˆ¥ã‚»ãƒªãƒ•ã ã£ãŸã‚Šã€å°ã•ãªãƒãƒƒãƒ—ãŒåˆã£ãŸã‚Š
export build_fromDownstair = ()->
	with Castle(mapdata)
		deployãƒ­ãƒ¼ãƒ©å§« = ->
			.charactors[] = with Charactor(14, 12, {0x32}) -- ãƒ­ãƒ¼ãƒ©å§«
				.talk = => MessageBoxRetro({ <index>: coroutine.wrap((_, _)->
					coroutine.yield 1, L('ãƒ­ãƒ¼ãƒ©ã€Œ%sã•ã¾ã¯ã€€ãƒ­ãƒ¼ãƒ©ã®ã“ã¨\nã€€ã€€ã€€ã€€ã‚’ã€€ãŠã‚‚ã£ã¦ãã ã•ã„ã¾ã™ã‹ï¼Ÿ')\format(g_player.name)
					sb = SelectBoxRetro({L'ã¯ã„', L'ã„ã„ãˆ'})
					coroutine.yield 1, sb\attach()
					coroutine.yield 1, L('\nãƒ­ãƒ¼ãƒ©ã€Œã†ã‚Œã—ã‚…ã†ã”ã•ã„ã¾ã™ã€‚ã½ã£')
					BGM()
					play_wait'assets/sounds/mml2ogg/ãƒ­ãƒ¼ãƒ©å§«æ•‘å‡º.ogg'
					BGM Castle.BGM
					nil
				)})\attach()
		.charactors[] = with Charactor(11,12,{0x30}) -- ç‹æ§˜
			.talk = =>
				if not lume.find(g_player.flags, L'ãƒ­ãƒ¼ãƒ©å§«ã‚’æ•‘å‡ºã—ãŸ')
					MessageBoxRetro({
						L('ï¼Šã€ŒãŠãŠã€€%sï¼\nã€€ã€€ã‚ˆããã€€ã‚‚ã©ã£ã¦ããŸï¼\nã€€ã€€ã‚ã—ã¯ã€€ã¨ã¦ã‚‚ã€€ã†ã‚Œã—ã„ãã€‚ğŸ”»')\format(g_player.name)
						if g_player.level < 30
							L('\nï¼Šã€ŒããªãŸãŒã€€ã¤ãã®ãƒ¬ãƒ™ãƒ«ã«ãªã‚‹ã«ã¯\nã€€ã€€ã‚ã¨%sãƒã‚¤ãƒ³ãƒˆã®\nã€€ã€€ã‘ã„ã‘ã‚“ãŒã²ã¤ã‚ˆã†ã˜ã‚ƒã€‚ğŸ”»')\format(toZenkaku(LevelUps[g_player.level+1].çµŒé¨“å€¤ - g_player.çµŒé¨“å€¤))
						else
							L('\nï¼Šã€ŒããªãŸã¯ã€€ã‚‚ã†ã€€ã˜ã‚…ã†ã¶ã‚“ã«\nã€€ã€€ã¤ã‚ˆã„ï¼ã€€ãªãœã«ã€€ã¾ã \nã€€ã€€ã‚Šã‚…ã†ãŠã†ã‚’ã€€ãŸãŠã›ã¬ã®ã‹ï¼ŸğŸ”»')
						--å†’é™ºã®æ›¸ã®ä¸‹ã‚Šã•ãã˜ã‚‡
						L('\nï¼Šã€Œã§ã¯ã€€ã¾ãŸã€€ã‚ãŠã†\nã€€ã€€ã‚†ã†ã—ã‚ƒã€€%sã‚ˆï¼ğŸ”»')\format(g_player.name)})\attach()
				else
					MessageBoxRetro({ <index>: coroutine.wrap((_, _)->
						coroutine.yield 1, L('ï¼Šã€ŒãŠãŠã€€%sï¼ã€€ã‚ˆãã\nã€€ã€€ã²ã‚ã‚’ã€€ãŸã™ã‘ã ã—ã¦ãã‚ŒãŸã€‚\nã€€ã€€ã“ã“ã‚ã‹ã‚‰ã€€ã‚Œã„ã‚’ã„ã†ãï¼ğŸ”»')\format(g_player.name)
						coroutine.yield 1, L('\nï¼Šã€Œã•ã‚ã€€ãƒ­ãƒ¼ãƒ©\nã€€ã€€ã‚ãŸã—ã®ã¨ãªã‚Šã¸ã€‚ğŸ”»')
						coroutine.yield 1, L('\nãƒ­ãƒ¼ãƒ©ã€Œã¾ã£ã¦ãã ã•ã„ã€‚ã€€ãƒ­ãƒ¼ãƒ©ã¯\nã€€ã€€ã€€ã€€%sã•ã¾ã«ã€€ãŠãã‚Šã‚‚ã®ã‚’\nã€€ã€€ã€€ã€€ã—ã¨ã†ã”ã–ã„ã¾ã™ã€‚ğŸ”»')\format(g_player.name)
						coroutine.yield 1, L('\nãƒ­ãƒ¼ãƒ©ã€Œ%sã‚’ã€€ã‚ã„ã™ã‚‹\nã€€ã€€ã€€ã€€ã‚ãŸã—ã®ã€€ã“ã“ã‚ã€‚ã©ã†ã‹\nã€€ã€€ã€€ã€€ã†ã‘ã¨ã£ã¦ãã ã•ã„ã¾ã›ã€‚ğŸ”»')\format(g_player.name)
						coroutine.yield 1, L('\nãƒ­ãƒ¼ãƒ©ã€Œã‚ã‚ï¼ã€€ãŸã¨ãˆã€€ã¯ãªã‚Œã¦\nã€€ã€€ã€€ã€€ã„ã¦ã‚‚ã€€ãƒ­ãƒ¼ãƒ©ã¯ã€€ã„ã¤ã‚‚\nã€€ã€€ã€€ã€€ã‚ãªãŸã¨ã€€ã¨ã‚‚ã«ã€€ã‚ã‚Šã¾ã™ã€‚ğŸ”»')
						coroutine.yield 1, L('\nãƒ­ãƒ¼ãƒ©ã€Œã§ã¯ã€%sã•ã¾â€¦â€¦ğŸ”»')\format(g_player.name)
						deployãƒ­ãƒ¼ãƒ©å§«()
						lume.remove(g_player.flags, L'ãƒ­ãƒ¼ãƒ©å§«ã‚’æ•‘å‡ºã—ãŸ')
						g_player.items[] = L'ãŠã†ã˜ã‚‡ã®ã‚ã„'
						g_player.chipids = if g_player.æ­¦å™¨ and g_player.ç›¾ then {0x26, 0x27}elseif g_player.ç›¾ then {0x24, 0x25} elseif g_player.æ­¦å™¨ then {0x22, 0x23} else {0x20, 0x21}
						--å†’é™ºã®æ›¸ã®ä¸‹ã‚Šã•ãã˜ã‚‡
						coroutine.yield 1, L('\nï¼Šã€Œã§ã¯ã€€ã¾ãŸã€€ã‚ãŠã†\nã€€ã€€ã‚†ã†ã—ã‚ƒã€€%sã‚ˆï¼ğŸ”»')\format(g_player.name)
						nil
					)})\attach()
		if lume.find(g_player.items, L'ãŠã†ã˜ã‚‡ã®ã‚ã„') then deployãƒ­ãƒ¼ãƒ©å§«()
		.charactors[] = with Charactor(11,15,{0x34,0x35}) -- å…µå£«
			.talk = => MessageBoxRetro({
				L'ï¼Šã€ŒãŠã‹ã­ãŒã€€ãŸã¾ã£ãŸã‚‰\nã€€ã€€ã¶ãã‚„ã¼ã†ãã‚’ã€€ãŸã‹ã„ã‚‚ã®ã«\nã€€ã€€ã‹ã„ã‹ãˆã‚‹ã“ã¨ã§ã™ã€‚ğŸ”»'
				L'\nï¼Šã€Œãã†ã™ã‚‹ãˆã°ã€€ã‚‚ã£ã¨\nã€€ã€€ã¤ã‚ˆããªã‚Œã‚‹ã§ã—ã‚‡ã†ã€‚ğŸ”»'})\attach()
		.charactors[] = with Charactor(13,15,{0x34,0x35}) -- å…µå£«
			.talk = => MessageBoxRetro({
				L'ï¼Šã€Œã²ã¨ã³ã¨ã®ã¯ãªã«ã—ã¯ã€€ã‚ˆã\nã€€ã€€ã¿ã¿ã‚’ã‹ãŸã‚€ã‘ã‚‹ã“ã¨ã§ã™ã€‚\nã€€ã€€ãã£ã¨ã€€ã‚„ãã«ãŸã¤ã§ã—ã‚‡ã†ğŸ”»'})\attach()
		.charactors[] = with Charactor(15,13,{0x34,0x35}) -- å…µå£«
			.update = coroutine.wrap(._update_randomwalk)
			.talk = =>
				sb1 = SelectBoxRetro({L'ã¯ã„', L'ã„ã„ãˆ'})
				MessageBoxRetro({ <index>: coroutine.wrap((_, _)->
					coroutine.yield 1, L'ï¼Šã€Œãƒ­ãƒ¼ãƒ©ã²ã‚ã®ã“ã¨ã‚’ã€€ã”ãã‚“ã˜ã‹ï¼Ÿ'
					coroutine.yield 1, sb1\attach() -- æ¬¡ã®ï¼’è¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—
					if 2 == sb1.index
						coroutine.yield 1, L'\nï¼Šã€Œã²ã‚ã•ã¾ãŒã€€ã¾ã‚‚ã®ãŸã¡ã«\nã€€ã€€ã•ã‚‰ã‚ã‚Œã¦ã€€ã¯ã‚“ã¨ã—ã«ãªã‚‹â€¦ğŸ”»'
						coroutine.yield 1, L'\nï¼Šã€ŒãŠã†ã•ã¾ã¯ã€€ãªã«ã‚‚\nã€€ã€€ãŠã£ã—ã‚ƒã‚‰ãªã„ãŒ\nã€€ã€€ã¨ã¦ã‚‚ã€€ãã‚‹ã—ã‚“ã§ã„ã‚‹ã¯ãšã€‚ğŸ”»'
					coroutine.yield 1, L('\nï¼Šã€Œ%sï¼\nã€€ã€€ã©ã†ã‹ã€€ã²ã‚ã‚’\nã€€ã€€ãŸã™ã‘ã ã—ã¦ã€€ãã ã•ã„ï¼ğŸ”»')\format(g_player.name)
					nil
				)})\attach()
		.traps[] = with {16, 17} --éšæ®µ
			.talk = =>
				play'assets/DQ1/éšæ®µ.ogg'
				Scene.current\blackout -> Scene.current = require('DQ1_ãƒ©ãƒ€ãƒˆãƒ¼ãƒ åŸ').build_fromç‰åº§()

		BGM Castle.BGM
		g_player.x, g_player.y = 16, 17


export build_æ­»ã«æˆ»ã‚Š = ()->
	with Castle(mapdata)
		.charactors[] = with Charactor(11,12,{0x30}) -- ç‹æ§˜
			.talk = =>
				if not lume.find(g_player.flags, L'å‘ªã„')
					MessageBoxRetro({
						L('ï¼Šã€ŒãŠãŠã€€%sï¼\nã€€ã€€ã—ã‚“ã§ã—ã¾ã†ã¨ã¯ã€€ãªã«ã”ã¨ã ï¼ğŸ”»\nã€€ã€€ã—ã‹ãŸã®ãªã„ã€€ã‚„ã¤ã ãªã€‚ğŸ”»')\format(g_player.name)
						L'\nï¼Šã€ŒãŠã¾ãˆã«ã€€ã‚‚ã†ã€€ã„ã¡ã©\nã€€ã€€ãã‹ã„ã‚’ã€€ã‚ãŸãˆã‚ˆã†ï¼ğŸ”»'
						L'\nï¼Šã€ŒãŸãŸã‹ã„ã§ã€€ã‚­ã‚ºã¤ã„ãŸã¨ãã¯\nã€€ã€€ã¾ã¡ã«ã‚‚ã©ã‚Šã€€ã‚„ã©ã‚„ã«ã€€ã¨ã¾ã£ã¦\nã€€ã€€ã‚­ã‚ºã‚’ã‹ã„ãµãã•ã›ã‚‹ã®ã ãã€‚ğŸ”»'
						L'\nï¼Šã€ŒãµãŸãŸã³ã€€ã“ã®ã‚ˆã†ãªã“ã¨ãŒ\nã€€ã€€ãŠã“ã‚‰ã¬ã“ã¨ã‚’\nã€€ã€€ã‚ã—ã¯ã€€ã„ã®ã£ã¦ã„ã‚‹ï¼ğŸ”»'
						-- L('\nï¼Šã€ŒããªãŸãŒã€€ã¤ãã®ãƒ¬ãƒ™ãƒ«ã«ãªã‚‹ã«ã¯\nã€€ã€€ã‚ã¨%sãƒã‚¤ãƒ³ãƒˆã®\nã€€ã€€ã‘ã„ã‘ã‚“ãŒã²ã¤ã‚ˆã†ã˜ã‚ƒã€‚ğŸ”»')\format(toZenkaku(LevelUps[g_player.level+1].çµŒé¨“å€¤ - g_player.çµŒé¨“å€¤))
						if g_player.level < 30
							L('\nï¼Šã€ŒããªãŸãŒã€€ã¤ãã®ãƒ¬ãƒ™ãƒ«ã«ãªã‚‹ã«ã¯\nã€€ã€€ã‚ã¨%sãƒã‚¤ãƒ³ãƒˆã®\nã€€ã€€ã‘ã„ã‘ã‚“ãŒã²ã¤ã‚ˆã†ã˜ã‚ƒã€‚ğŸ”»')\format(toZenkaku(LevelUps[g_player.level+1].çµŒé¨“å€¤ - g_player.çµŒé¨“å€¤))
						else
							L('\nï¼Šã€ŒããªãŸã¯ã€€ã‚‚ã†ã€€ã˜ã‚…ã†ã¶ã‚“ã«\nã€€ã€€ã¤ã‚ˆã„ï¼ã€€ãªãœã«ã€€ã¾ã \nã€€ã€€ã‚Šã‚…ã†ãŠã†ã‚’ã€€ãŸãŠã›ã¬ã®ã‹ï¼ŸğŸ”»')
						--å†’é™ºã®æ›¸ã®ä¸‹ã‚Šã•ãã˜ã‚‡
						L('\nï¼Šã€Œã§ã¯ã€€ã¾ãŸã€€ã‚ãŠã†\nã€€ã€€ã‚†ã†ã—ã‚ƒã€€%sã‚ˆï¼ğŸ”»')\format(g_player.name)})\attach()
				else
					MessageBoxRetro({ <index>: coroutine.wrap((_, _)->
						coroutine.yield 1, L('ï¼Šã€ŒãŠãŠã€€%sï¼\nã€€ã€€ã—ã‚“ã§ã—ã¾ã†ã¨ã¯ã€€ãªã«ã”ã¨ã ï¼ğŸ”»\nã€€ã€€ã—ã‹ã‚‚ã€€ã®ã‚ã‚ã‚Œã¦ã„ã‚‹ã§ã¯ãªã„ã‹ï¼ğŸ”»\nã€€ã€€ã®ã‚ã‚ã‚Œã—ã‚‚ã®ã‚ˆã€€ã§ã¦ã‚†ã‘ï¼ğŸ”»')\format(g_player.name)
						g_player.hp = 1
						Scene.current\detach()
						Scene.current\blackout -> Scene.current = require('DQ1_å…¨ä½“ãƒãƒƒãƒ—').build_atãƒ©ãƒ€ãƒˆãƒ¼ãƒ åŸ()
						nil
					)})\attach()
		.traps[] = with {16, 17} --éšæ®µ
			.talk = =>
				play'assets/DQ1/éšæ®µ.ogg'
				Scene.current\blackout -> Scene.current = require('DQ1_ãƒ©ãƒ€ãƒˆãƒ¼ãƒ åŸ').build_fromç‰åº§()
		BGM Castle.BGM
		g_player.hp, g_player.mp, g_player.gold = g_player.maxhp, g_player.maxmp, idiv(g_player.gold, 2)
		g_player.x, g_player.y, g_player.direction = 11, 13, {0, -1}


export build_opening = ()->
	with Castle(mapdata)
		.charactors[] = with Charactor(11,12,{0x30}) -- ç‹æ§˜
			.talk = => -- [*] bug å•†äººã®ãƒ†ãƒ¼ãƒ–ãƒ«ã¨å…±ç”¨ãªã®ã§æŒŸã‚“ã å…ˆã®ã‚‚ã®ã‚‚æ‰±ãˆã¦ã—ã¾ã†
				MessageBoxRetro({
					L('ï¼Šã€ŒãŠãŠã€€%sï¼\nã€€ã€€ã‚†ã†ã—ã‚ƒãƒ­ãƒˆã®ã€€ã¡ã‚’ã²ãã‚‚ã®ã‚ˆï¼\nã€€ã€€ããªãŸã®ãã‚‹ã®ã‚’ã¾ã£ã¦ãŠã£ãŸãã€‚ğŸ”»')\format(g_player.name)
					L'\nï¼Šã€Œãã®ã€€ã‚€ã‹ã—ã€€ã‚†ã†ã—ã‚ƒãƒ­ãƒˆãŒ\nã€€ã€€ã‚«ãƒŸã‹ã‚‰ã€€ã²ã‹ã‚Šã®ãŸã¾ã‚’ã•ãšã‹ã‚Š\nã€€ã€€ã¾ã‚‚ã®ãŸã¡ã‚’ãµã†ã˜ã“ã‚ãŸã¨ã„ã†ã€‚ğŸ”»'
					L'\nï¼Šã€Œã—ã‹ã—ã€€ã„ãšã“ã¨ã‚‚ãªãã‚ã‚‰ã‚ã‚ŒãŸ\nã€€ã€€ã‚ãã¾ã®ã‘ã—ã‚“ã€€ã‚Šã‚…ã†ãŠã†ãŒ\nã€€ã€€ãã®ãŸã¾ã‚’ã€€ã‚„ã¿ã«ã¨ã–ã—ãŸã®ã˜ã‚ƒğŸ”»'
					L'\nï¼Šã€Œã“ã®ã¡ã«ã€€ãµãŸãŸã³ã¸ã„ã‚ã‚’ã£ï¼ğŸ”»'
					L('\nï¼Šã€Œã‚†ã†ã—ã‚ƒã€€%sã‚ˆï¼\nã€€ã€€ã‚Šã‚…ã†ãŠã†ã‚’ãŸãŠã—ã€€ãã®ã¦ã‹ã‚‰\nã€€ã€€ã²ã‹ã‚Šã®ãŸã¾ã‚’ã¨ã‚Šã‚‚ã®ã—ã¦ãã‚Œï¼ğŸ”»')\format(g_player.name)
					L'\nï¼Šã€Œã‚ã—ã‹ã‚‰ã®ã€€ãŠãã‚Šã‚‚ã®ã˜ã‚ƒï¼\nã€€ã€€ããªãŸã®ã‚ˆã“ã«ã‚ã‚‹\nã€€ã€€ã¯ã‹ã‚‰ã®ã¯ã“ã‚’ã€€ã¨ã‚‹ãŒã‚ˆã„ï¼ğŸ”»'
					L'\nï¼Šã€Œãã—ã¦ã€€ã“ã®ã¸ã‚„ã«ã„ã‚‹\nã€€ã€€ã¸ã„ã—ã«ãã‘ã°ã€€ãŸã³ã®ã¡ã—ãã‚’\nã€€ã€€ãŠã—ãˆã¦ãã‚Œã‚ˆã†ã€‚ğŸ”»'
					L('\nï¼Šã€Œã§ã¯ã€€ã¾ãŸã€€ã‚ãŠã†\nã€€ã€€ã‚†ã†ã—ã‚ƒã€€%sã‚ˆï¼ğŸ”»')\format(g_player.name)})\attach()
		.charactors[] = æ‰‰(12,16, 'ã‚ªãƒ¼ãƒ—ãƒ‹ãƒ³ã‚°ã®æ‰‰')
		.charactors[] = å®ç®±(12,13, 120) -- å®ç®±
		.charactors[] = å®ç®±(13,13, L'ãŸã„ã¾ã¤') -- å®ç®±
		.charactors[] = å®ç®±(14,10, L'ã‹ã') -- å®ç®±
		.charactors[] = with Charactor(11,15,{0x34,0x35}) -- å…µå£«
			.talk = => MessageBoxRetro({
				L'ï¼Šã€Œã“ã®ã—ã‚ã‚’ã§ã‚‹ã¨ã€€ã¨ãªã‚Šã«\nã€€ã€€ã¾ã¡ãŒã€€ã‚ã‚‹ã€‚ğŸ”»'
				L'\nï¼Šã€Œãã“ã§ã€€ã¾ãšã€€ã¶ãã¨ã€€ã¼ã†ãã‚’\nã€€ã€€ã‹ã„ãã‚ãˆã‚‹ã“ã¨ã ã€‚ğŸ”»'
				L'\nï¼Šã€ŒãŸãŸã‹ã„ã§ã€€ããšã¤ã„ãŸã¨ãã¯\nã€€ã€€ã¾ã¡ã«ã‚‚ã©ã‚Šã€€ã‚„ã©ã‚„ã«ã¨ã¾ã‚‹ã¨\nã€€ã€€ããšãŒã€€ã‹ã„ãµãã™ã‚‹ã ã‚ã†ã€‚ğŸ”»'})\attach()
		.charactors[] = with Charactor(13,15,{0x34,0x35}) -- å…µå£«
			.talk = => MessageBoxRetro({
				L'ï¼Šã€ŒãŸã‹ã‚‰ã®ã¯ã“ã‚’ã€€ãœã‚“ã¶ã¨ã£ãŸãªã‚‰\nã€€ã€€ãã®ãªã‹ã«ã€€ã‹ããŒã€€ã¯ã„ã£ã¦ã„ãŸ\nã€€ã€€ã¯ãšã ã€‚ğŸ”»'
				L'\nï¼Šã€Œã‹ãã¯ã€€ï¼‘ã©ã¤ã‹ã†ã¨ã€€ãªããªã£ã¦\nã€€ã€€ã—ã¾ã†ãŒã€€ãã®ã‹ãã§ã€€ã¨ã³ã‚‰ã‚’\nã€€ã€€ã‚ã‘ãŸã¨ãâ€¦â€¦ğŸ”»'
				L'\nï¼Šã€ŒãŠã¾ãˆã®ãŸã³ãŒã€€ã¯ã˜ã¾ã‚‹ã ã‚ã†ã€‚ğŸ”»'})\attach()
		.charactors[] = with Charactor(15,13,{0x34,0x35}) -- å…µå£«
			.update = coroutine.wrap(._update_randomwalk)
			.talk = =>
				sb1 = SelectBoxRetro({L'ã¯ã„', L'ã„ã„ãˆ'})
				MessageBoxRetro({ <index>: coroutine.wrap((_, _)->
					coroutine.yield 1, 'ï¼Šã€Œãƒ­ãƒ¼ãƒ©ã²ã‚ã®ã“ã¨ã‚’ã€€ã”ãã‚“ã˜ã‹ï¼Ÿ'
					coroutine.yield 1, sb1\attach()
					if 2 == sb1.index
						coroutine.yield 1, L'\nï¼Šã€Œã²ã‚ã•ã¾ãŒã€€ã¾ã‚‚ã®ãŸã¡ã«\nã€€ã€€ã•ã‚‰ã‚ã‚Œã¦ã€€ã¯ã‚“ã¨ã—ã«ãªã‚‹â€¦ğŸ”»'
						coroutine.yield 1, L'\nï¼Šã€ŒãŠã†ã•ã¾ã¯ã€€ãªã«ã‚‚\nã€€ã€€ãŠã£ã—ã‚ƒã‚‰ãªã„ãŒ\nã€€ã€€ã¨ã¦ã‚‚ã€€ãã‚‹ã—ã‚“ã§ã„ã‚‹ã¯ãšã€‚ğŸ”»'
					coroutine.yield 1, L('\nï¼Šã€Œ%sï¼\nã€€ã€€ã©ã†ã‹ã€€ã²ã‚ã‚’\nã€€ã€€ãŸã™ã‘ã ã—ã¦ã€€ãã ã•ã„ï¼ğŸ”»')\format(g_player.name)
					nil
				)})\attach()
		.traps[] = with {16, 17} --éšæ®µ
			.talk = =>
				play'assets/DQ1/éšæ®µ.ogg'
				Scene.current\blackout -> Scene.current = require('DQ1_ãƒ©ãƒ€ãƒˆãƒ¼ãƒ åŸ').build_fromç‰åº§()
		BGM Castle.BGM
		g_player.x, g_player.y = 11, 13
