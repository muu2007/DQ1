import 'macros' as {$}
import 'utl' as :L, :play
import 'lib.lume'
import 'ui' as :Scene, :BGM
import 'main' as :Dungeon, :Charactor, :MessageBoxRetro, :g_player
local *


_ = $mml2ogg([[
Tempo(110)
Track(1) q100 @8 o5 l4
a-b-a-b-ã€€>c+<b-a-b-8a-8ã€€g f8g8b-8a-8g-8f8ã€€ed8e8gcã€€l32[8 f+e] q50f+4r4q100ã€€[8 fe-]q50f4r4q100
Track(2) q100 @8 v75 o5 l16
[8 rb>dg<] [2 rb>c+e<][2 rb>df<]ã€€[4 rfa->c<]ã€€l32[8 <b->c] q50<b-4r4>q100ã€€[8 <ab>]q50a4r4q100
]], dungeon, 14.4) --60/110 *4 *6


mapdata1B = $to2d [[
EEEEEEEEEEEEEEEEEEEEEEEEEEE
EEEEEEEEEEEEEEEEEEEEEEEEEEE
EEEEEEEEEEEEEEEEEEEEEEEEEEE
EEEEEEEEEEEEEEEEEEEEEEEEEEE
EEEEEEEEEEEEEEEEEEEEEEEEEEE
EEEEEEEEEEEEEEEEEEEEEEEEEEE
EEEEEEEEEEEEEEEEEEEEEEEEEEE
EEEEEEEEEEEEEEEEEEEEEEEEEEE
EEEEEEEECCCCCCCCCCCCEEEEEEE
EEEEEEEEC3'C''''CC'CEEEEEEE
EEEEEEEECC'C'CC''''CEEEEEEE
EEEEEEEEC'''''''CC'CEEEEEEE
EEEEEEEECC'CCC'CC''CEEEEEEE
EEEEEEEEC''C'''C''CCEEEEEEE
EEEEEEEEC'CCCC'''CCCEEEEEEE
EEEEEEEEC''''''C'C'CEEEEEEE
EEEEEEEECCC'C'CC'''CEEEEEEE
EEEEEEEECC'''''C'C'CEEEEEEE
EEEEEEEECC'C'C'''C4CEEEEEEE
EEEEEEEECCCCCCCCCCCCEEEEEEE
EEEEEEEEEEEEEEEEEEEEEEEEEEE
EEEEEEEEEEEEEEEEEEEEEEEEEEE
EEEEEEEEEEEEEEEEEEEEEEEEEEE
EEEEEEEEEEEEEEEEEEEEEEEEEEE
EEEEEEEEEEEEEEEEEEEEEEEEEEE
EEEEEEEEEEEEEEEEEEEEEEEEEEE
EEEEEEEEEEEEEEEEEEEEEEEEEEE
EEEEEEEEEEEEEEEEEEEEEEEEEEE
EEEEEEEEEEEEEEEEEEEEEEEEEEE]]

mapdata2B = $to2d [[
EEEEEEEEEEEEEEEEEEEEEEEEEEE
EEEEEEEEEEEEEEEEEEEEEEEEEEE
EEEEEEEEEEEEEEEEEEEEEEEEEEE
EEEEEEEEEEEEEEEEEEEEEEEEEEE
EEEEEEEEEEEEEEEEEEEEEEEEEEE
EEEEEEEEEEEEEEEEEEEEEEEEEEE
EEEEEEEEEEEEEEEEEEEEEEEEEEE
EEEEEEEEEEEEEEEEEEEEEEEEEEE
EEEEEEEECCCCCCCCCCCCEEEEEEE
EEEEEEEEC''''''''''CEEEEEEE
EEEEEEEEC'CCCCC'CCCCEEEEEEE
EEEEEEEEC'''''C'C''CEEEEEEE
EEEEEEEECCCC'CC''''CEEEEEEE
EEEEEEEEC''''C'CC''CEEEEEEE
EEEEEEEEC'C'CC'C'CCCEEEEEEE
EEEEEEEEC'CC'C'''''CEEEEEEE
EEEEEEEEC''''C''CC'CEEEEEEE
EEEEEEEECC'C''''C''CEEEEEEE
EEEEEEEEC'''C'''C3'CEEEEEEE
EEEEEEEECCCCCCCCCCCCEEEEEEE
EEEEEEEEEEEEEEEEEEEEEEEEEEE
EEEEEEEEEEEEEEEEEEEEEEEEEEE
EEEEEEEEEEEEEEEEEEEEEEEEEEE
EEEEEEEEEEEEEEEEEEEEEEEEEEE
EEEEEEEEEEEEEEEEEEEEEEEEEEE
EEEEEEEEEEEEEEEEEEEEEEEEEEE
EEEEEEEEEEEEEEEEEEEEEEEEEEE
EEEEEEEEEEEEEEEEEEEEEEEEEEE
EEEEEEEEEEEEEEEEEEEEEEEEEEE]]


class ãƒ­ãƒˆã®æ´çªŸ extends Dungeon
	ãƒªãƒ¬ãƒŸãƒˆ: => Scene.current\blackout -> Scene.current = require('DQ1_å…¨ä½“ãƒãƒƒãƒ—').build_atãƒ­ãƒˆã®æ´çªŸ()
	

build_1B = ->
	with ãƒ­ãƒˆã®æ´çªŸ(mapdata1B)
		.traps[] = with {9, 9}
			.talk = =>
				play'assets/DQ1/éšæ®µ.ogg'
				Scene.current\blackout -> Scene.current = require('DQ1_å…¨ä½“ãƒãƒƒãƒ—').build_atãƒ­ãƒˆã®æ´çªŸ()
		.traps[] = with {18, 18}
			.talk = =>
				play'assets/DQ1/éšæ®µ.ogg'
				Scene.current\blackout -> Scene.current = build_2B()
		-- .ãƒªãƒ¬ãƒŸãƒˆ = -> Scene.current\blackout -> Scene.current = require('DQ1_å…¨ä½“ãƒãƒƒãƒ—').build_atãƒ­ãƒˆã®æ´çªŸ()


export build_fromåœ°ä¸Š = ->
	with build_1B()
		g_player.x, g_player.y = 9, 9
		BGM Dungeon.BGM

build_from2B = ->
	with build_1B()
		g_player.x, g_player.y = 18, 18

build_2B = ->
	with ãƒ­ãƒˆã®æ´çªŸ(mapdata2B)
		.traps[] = with {17, 18}
			.talk = =>
				play'assets/DQ1/éšæ®µ.ogg'
				Scene.current\blackout -> Scene.current = build_from2B()
		.charactors[] = with Charactor(18, 12, {0x10}) -- å®ç®±
			.talk = =>
				play'assets/DQ1/å®ç®±.ogg'
				lume.remove(Scene.current.charactors, @)
				MessageBoxRetro({L'ã‚ãŸã—ã®ãªã¯ã€€ãƒ­ãƒˆã€€ã‚ãŸã—ã®ã€€ã¡ã‚’ã²ãã—ã‚‚ã®ã‚ˆã€‚ğŸ”»'
					L'\nãƒ©ãƒ€ãƒˆãƒ¼ãƒ ã‹ã‚‰ã¿ãˆã‚‹ã€€ã¾ã®ã—ã¾ã«ã€€ã‚ãŸã‚‹ã«ã¯ã€€ï¼“ã¤ã®ã‚‚ã®ãŒã€€ã²ã¤ã‚ˆã†ã ã£ãŸã€‚ğŸ”»'
					L'\nã‚ãŸã—ã¯ã€€ãã‚Œã‚‰ã‚’ã€€ã‚ã¤ã‚ã€€ã¾ã®ã—ã¾ã«ã€€ã‚ãŸã‚Šã€€ã¾ãŠã†ã‚’ã€€ãŸãŠã—ãŸã€‚ğŸ”»'
					L'\nãã—ã¦ã€€ã„ã¾ã€€ãã®ï¼“ã¤ã®ã€€ã—ã‚“ã´ãªã‚‹ã‚‚ã®ã‚’ã€€ï¼“ã«ã‚“ã®ã€€ã‘ã‚“ã˜ã‚ƒã«ã€€ãŸãã™ã€‚ğŸ”»'
					L'\nã‹ã‚Œã‚‰ã®ã€€ã—ãã‚“ãŒã€€ãã‚Œã‚‰ã‚’ã€€ã¾ã‚‚ã£ã¦ã‚†ãã ã‚ã†ã€‚ğŸ”»'
					L'\nãµãŸãŸã³ã€€ã¾ã®ã—ã¾ã«ã€€ã‚ããŒã€€ã‚ˆã¿ãŒãˆã£ãŸã¨ãã€€ãã‚Œã‚‰ã‚’ã€€ã‚ã¤ã‚ã€€ãŸãŸã‹ã†ãŒã‚ˆã„ã€‚ğŸ”»'
				})\attach()
		-- .ãƒªãƒ¬ãƒŸãƒˆ = -> Scene.current\blackout -> Scene.current = require('DQ1_å…¨ä½“ãƒãƒƒãƒ—').build_atãƒ­ãƒˆã®æ´çªŸ()
		g_player.x, g_player.y = 17, 18
	
